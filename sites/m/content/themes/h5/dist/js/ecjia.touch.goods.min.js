!function(t,e){t.touch.category={init:function(){t.touch.category.openSelection(),t.touch.category.selectionValue(),t.touch.category.clear_filter()},openSelection:function(){e('[data-toggle="openSelection"]').on("click",function(t){t.preventDefault(),e(".goods-filter-box").toggleClass("show")}),e('[data-toggle="closeSelection"]').on("click",function(t){t.preventDefault(),e(".goods-filter-box").hasClass("show")?e(".goods-filter-box").removeClass("show"):e(".goods-filter-box").addClass("show")})},selectionValue:function(){e(".goods-filter .title").on("click",function(t){t.preventDefault();var a=e(this).find(".icon-jiantou-bottom"),o=e(this).next("ul");a.hasClass("down")?(a.removeClass("down"),o.removeClass("show")):(a.addClass("down"),o.addClass("show"))}),e(".goods-filter .goods-filter-box-content .goods-filter-box-listtype ul li a").on("click",function(t){t.preventDefault();var a=e(this).parent("li").parent("ul").prev(".title").attr("id"),o=e(this).attr("value");if("filter_brand"==a)e(".brandname").val(o);else{var i;i=o.split("|"),e("input[name='price_min']").val(i[0]),e("input[name='price_max']").val(i[1])}e(this).parent("li").parent("ul").prev(".title").children(".range").text(e(this).text()),e(this).parent("li").parent("ul").removeClass("show"),e(this).parent("li").parent("ul").prev(".title").children("i").removeClass("down")}),e(".goods-filter .goods-filter-box-content .btns .btn-default").on("click",function(t){t.preventDefault(),e(".goods-filter .goods-filter-box-content .goods-filter-box-listtype .title").each(function(t){e(this).children(".range").text("全部")})})},clear_filter:function(){e('[data-toggle="clear_filter"]').on("click",function(t){t.preventDefault(),e("input[name='price_min']").val(""),e("input[name='price_max']").val(""),e("input[name='brand']").val(""),e(".touchweb-com_listType .range").text("全部"),e(".touchweb-com_listType input").each(function(){"cat"!=e(this).attr("class")&&e(this).val("")})})}},t.touch.comment={init:function(){t.touch.comment.level_change()},level_change:function(){e('input[name="level-hide"]').val(""),e('input[name="email"]').val(""),e("textarea").val(""),e(".comment-level span").on("mouseover",function(){var t=e(this),a=e(this).attr("data-level"),o=e('input[name="level-hide"]');t.parent("span").attr("class","comment-level rating rating"+a),t.on("click",function(){o.val(t.attr("data-level"))})})}},t.touch.goods={init:function(){t.touch.goods.collect_click(),t.touch.goods.open_booking(),t.touch.goods.addToCart_click(),t.touch.goods.changeprice_click(),t.touch.goods.changeprice_once(),t.touch.goods.choose_option()},collect_click:function(){e('[data-toggle="collect"]').on("click",function(){var a=e(this),o=a.attr("data-url"),i=a.attr("data-id"),n=a.hasClass("active");return o&&i?void t.touch.goods.collect({thisobj:a,url:o,id:i,act:n}):void alert("缺少必要参数，收藏失败")})},collect:function(a){e.get(a.url,{id:a.id},function(e){"success"==e.state&&a.thisobj.toggleClass("active"),t.touch.showmessage(e)},"json")},open_booking:function(){e('[data-toggle="booking"]').on("click",function(a){a.preventDefault();var o=e(this).attr("data-pjaxurl");window.confirm("商品库存不足\n是否添加缺货登记？","标题")&&t.pjax(o)})},addToCart_click:function(){e('[data-toggle="addToCart"]').on("click",function(a){a.preventDefault();var o=e(this),i={$form:e("#ECS_FORMBUY"),id:o.attr("data-id"),url:o.attr("data-url"),pjaxurl:o.attr("data-pjaxurl"),parentid:o.attr("data-parentid"),number:e('input[name="number"]').val(),quick:0,alt:o.attr("data-message")};return i.url&&i.id?void t.touch.goods.addToCart(i):void alert("缺少必要参数，添加购物车失败")})},addToCart:function(a){var o=a.$form,i=a.quick,n=a.number,c=a.id,l=(a.message,a.url),r=a.pjaxurl,s=a.parentid,d=a.alt,u=[];if(o.length){var g=0;o.find("[name^=spec_]").each(function(t){var a=e(this),o=a.attr("type");"checkbox"==o?a.is(":checked")&&(u[g]=a.val(),g++):("radio"==o&&a.is(":checked")||a.is("select"))&&(u[g]=a.val(),g++)}),e('[name="number"]').length&&(n=e('[name="number"]').val()),i=1}var p={quick:i,spec:u,goods_id:c,number:n,parent:s};e.post(l,{goods:p},function(a){if("success"==a.state)if(d)t.pjax(r);else{t.touch.toast("添加购物车成功");var o=e(".buttom-collect-cart sup").text();e(".buttom-collect-cart sup").text(parseInt(o)+1)}else alert(a.message)},"json")},changeprice_click:function(){e('[data-toggle="changeprice"]').on("click",function(){var a=e(this),o=a.attr("data-option"),i=e("#goods_number").val(),n={id:a.attr("data-id"),url:a.attr("data-url")};"del"==o?1==i?(i=1,e("#goods_number").val(i)):(i=parseInt(i)-1,e("#goods_number").val(i)):(i=parseInt(i)+1,e("#goods_number").val(i)),t.touch.goods._change_price(n,i)}),e('[data-toggle="changeprice_change"]').on("change",function(){var a=e(this),o=e("#goods_number").val(),i={id:a.attr("data-id"),url:a.attr("data-url")};t.touch.goods._change_price(i,o)}),e('[data-toggle="changeprice_blur"]').on("blur",function(){var a=e(this),o=e("#goods_number").val(),i={id:a.attr("data-id"),url:a.attr("data-url")};0>=o&&(o=1,e("#goods_number").val(1)),t.touch.goods._change_price(i,o)}),e('[data-toggle="changeprice_parts"]').on("click",function(){var a=e(this),o=e("#goods_number").val(),i={id:a.attr("data-id"),url:a.attr("data-url")};t.touch.goods._change_price(i,o)})},changeprice_once:function(){var t=e('[data-toggle="changeprice"]'),a=t.attr("data-id"),o=t.attr("data-url"),i=t.attr("data-option"),n=e("#goods_number").val();"del"==i?1==n?(n=1,e("#goods_number").val(n)):(n=parseInt(n)-1,e("#goods_number").val(n)):(n=parseInt(n)+1,e("#goods_number").val(n)),e.get(o,{id:a,attr:"",number:n},function(t){e("#ECS_GOODS_AMOUNT").html(t.message)},"json")},_change_price:function(t,a){for(var o="",i=0;i<e('[data-toggle="changeprice_change"]').length;i++)o+=e('[data-toggle="changeprice_change"]').eq(i).val()+",";for(var i=0;i<e('[data-toggle="changeprice_parts"]').length;i++)o=e('[data-toggle="changeprice_parts"]').eq(i).is(":checked")?o+","+e('[data-toggle="changeprice_parts"]').eq(i).val():o;e.get(t.url,{id:t.id,attr:o,number:a},function(t){e("#ECS_GOODS_AMOUNT").html(t.message)},"json")},goods_img:function(){var t,a,o,i=e(".scroller-slidenext .slidenext-msg"),n=e(".scroller-slidenext .slidenext-icon");new Swiper(".goods-imgshow",{grabCursor:!0,centeredSlides:!0,coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},slidesPerView:1,onTouchStart:function(e,a){t=a.touches&&a.touches[0].pageX?a.touches[0].pageX:a.pageX},onTouchMove:function(e,c){e.isEnd&&(a=c.touches&&c.touches[0].pageX?c.touches[0].pageX:c.pageX,o=n.hasClass("active"),-80>a-t?(!o&&n.addClass("active"),!o&&i.text("释放查看详情")):(o&&n.removeClass("active"),o&&i.text("滑动查看详情")))},onTouchEnd:function(o,i){o.isEnd&&(a=i.changedTouches&&i.changedTouches[0].pageX?i.changedTouches[0].pageX:i.pageX,-80>a-t&&e(".goods-detail a").eq(0).trigger("click"))}});e.support.pjax||e(".goods-detail a").eq(0).on("click",function(t){t.preventDefault(),window.location.href=e(".goods-detail a").eq(0).attr("href")})},goods_link:function(){new Swiper(".goods-link-likeshow",{paginationClickable:!0,spaceBetween:10,freeMode:!0,scrollbar:".swiper-scrollbar",slidesPerView:"auto"})},choose_option:function(){e(".goods-option-conr label").on("click",function(t){var a=e(this);a.hasClass("option-checkbox")?a.prev("input").is(":checked")?a.removeClass("active"):a.addClass("active"):a.addClass("active").siblings("label").removeClass("active")})},add_quick:function(){e(".addToCart_quick").on("click",function(a){var o=e(this),i=o.attr("data-url"),n=o.attr("data-id"),c=o.attr("data-parent");t.touch.goods.tmp_good_info.img=o.parents("li").find(".ecjiaf-fl img").attr("src"),t.touch.goods.tmp_good_info.name=o.parents("li").find(".goods-fitting p").eq(0).find("a").text(),t.touch.goods.tmp_good_info.price=o.parents("li").find(".goods-fitting p").eq(1).find("span").eq(1).text(),t.touch.goods.tmp_good_info.id=o.attr("data-id"),t.touch.goods.tmp_good_info.parentid=o.attr("data-parent")||0,e.post(i,{goods:{goods_id:n,parent:c,number:1,spec:{}}},function(e){"error"==e.state&&6==e.error?t.touch.goods.openSpeDiv(e.message,e.goods_id,e.parent):t.touch.showmessage(e)},"json")})},openSpeDiv:function(a,o,i){e(".alert-goods-attribute > .hd").html('<img src="'+t.touch.goods.tmp_good_info.img+'" alt="'+t.touch.goods.tmp_good_info.name+'"/><i class="glyphicon glyphicon-remove"></i><p class="alert-goods-name">商品名称'+t.touch.goods.tmp_good_info.name+'</p><p class="alert-price"><b id="ECS_GOODS_AMOUNT">'+t.touch.goods.tmp_good_info.price+"</b></p>"),e('.alert-goods-attribute form .ft [data-toggle="addToCart"]').attr({"data-parentid":t.touch.goods.tmp_good_info.parentid,"data-id":t.touch.goods.tmp_good_info.id}),e(".alert-goods-attribute form .bd").html("");for(var n=0;n<a.length;n++){var c=e('<div class="goods-option-con"><div class="goods-option-conr"></div>'),l=c.find(".goods-option-conr");if(l.before('<span class="spec-name">'+a[n].name+"</span>"),1==a[n].attr_type){for(var r=0;r<a[n].values.length;r++)0==r?l.append('<label class="option-radio active"><input name="spec_'+a[n].attr_id+'" type="radio" checked="checked" value="'+a[n].values[r].id+'" />'+a[n].values[r].label+"["+a[n].values[r].format_price+"]</label>"):l.append('<label class="option-radio"><input name="spec_'+a[n].attr_id+'" type="radio" value="'+a[n].values[r].id+'" />'+a[n].values[r].label+"["+a[n].values[r].format_price+"]</label>");l.append("<input type='hidden' name='spec_list' value='"+r+"' />")}else{for(var r=0;r<a[n].values.length;r++)l.append('<label class="option-checkbox"><input name="spec_'+a[n].attr_id+'" type="checkbox" value="'+a[n].values[r].id+'" /><i class="glyphicon glyphicon-ok"></i>'+a[n].values[r].label+"["+a[n].values[r].format_price+"]</label>");l.append("<input type='hidden' name='spec_list' value='"+r+"' />")}e(".alert-goods-attribute form .bd").append(c)}e(".alert-goods-attribute").css("display","block"),e(".glyphicon-remove").on("click",function(){e(".alert-goods-attribute").css("display","none")}),e(".alert-goods-attribute form .bd label").on("click",function(){var t=e(this);e(".alert-goods-attribute form .goods-option-conr label.option-radio").each(function(e){t.find("input").is(":checked")?t.addClass("active"):t.removeClass("active")}),t.hasClass("option-checkbox")?t.find("input").is(":checked")?t.removeClass("active"):t.addClass("active"):t.addClass("active").siblings("label").removeClass("active")}),e('.alert-goods-attribute form .ft [data-toggle="addToCart"]').on("click",function(a){a.preventDefault();var o=e(this),i={$form:e(".alert-goods-attribute form"),id:o.attr("data-id"),message:o.attr("data-message"),url:o.attr("data-url"),pjaxurl:o.attr("data-pjaxurl"),parentid:o.attr("data-parentid"),number:1,quick:1};return i.url&&i.id?void t.touch.goods.addToCart(i):void alert("缺少必要参数，添加购物车失败")})}}}(ecjia,jQuery);